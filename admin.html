<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin - Link Shortener</title>
  <style>
    body { font-family: sans-serif; max-width: 500px; margin: auto; padding: 1rem; }
    input, button { margin: 0.5rem 0; padding: 0.5rem; width: 100%; }
    pre { background: #f4f4f4; padding: 1rem; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Admin Panel</h1>
  <input id="code" placeholder="Short code (e.g. yt)" />
  <input id="url" placeholder="Full URL (e.g. https://youtube.com)" />
  <button onclick="addLink()">Add Link</button>

  <p id="msg"></p>

  <script>
    const token = "YOUR_PERSONAL_ACCESS_TOKEN"; // ⚠️ DO NOT expose real token in public repo
    const owner = "coder11v";
    const repo = "nolonglinks";
    const path = "links.json";

    async function addLink() {
      const code = document.getElementById("code").value.trim();
      const url = document.getElementById("url").value.trim();
      if (!code || !url) return alert("Both fields required");

      // Get current file
      const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
        headers: { Authorization: `token ${token}` }
      });
      const file = await res.json();
      const content = atob(file.content);
      const links = JSON.parse(content);

      // Add link
      links[code] = url;
      const updated = JSON.stringify(links, null, 2);

      // Commit back
      const commitRes = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
        method: "PUT",
        headers: {
          Authorization: `token ${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          message: `Add shortlink ${code}`,
          content: btoa(updated),
          sha: file.sha
        })
      });

      if (commitRes.ok) {
        document.getElementById("msg").textContent = `✅ Link added: /${code}`;
      } else {
        document.getElementById("msg").textContent = "❌ Failed to commit";
      }
    }
  </script>
</body>
</html>
